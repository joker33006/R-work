ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-5)
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)
plot_b1 <- plot_b1[order(order)]
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)+
theme_classic()
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
stat_unique(code)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)+
theme_classic()+
axe
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
stat_unique(groups)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)+
theme_classic()+
axe
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
stat_unique(data=plot_b1,groups)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)+
theme_classic()+
axe
plot_b1 <- plot_b1[order(order)]
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(aes(label = groups),stat="unique", check_overlap = TRUE,vjust=-6)+
theme_classic()+
axe
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(aes(label = groups),stat="unique", check_overlap = TRUE,vjust=-6)+
theme_classic()
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)+
theme_classic()+
axe
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)+
theme_classic()
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)+
theme_classic()+
labs(x='species code',y='The annual average temperature')
ggsave(paste0(path,"plot_result"),width = 10,height = 5,dpi=600)
ggplot(data=plot_b1,aes(x=as.factor(reorder(code,order)),y=bio_1/10))+
geom_boxplot(outlier.colour=NA)+
geom_text(data=order_1,aes(label = groups), check_overlap = TRUE,vjust=-6)+
theme_classic()+
labs(x='Species code',y='The annual average temperature')
ggsave(paste0(path,"plot_result/bio_1.jpeg"),width = 10,height = 5,dpi=600)
ggsave(paste0(path,"plot_result/bio_1.jpeg"),width = 12,height = 5,dpi=600)
############################### multiple comparison of rainfall
aov12 <- aov(bio_12~code,data=rloc)
tuk <- HSD.test(aov12,"code")
order_12 <-tuk$group
order_12 <- as.data.table(cbind(order_12,rownames(order_12),c(1:length(order_12[,1]))))
library(data.table)
library(ggplot2)
library(useful)
library(multcomp)
library(multcompView)
library(agricolae)
############################### multiple comparison of rainfall
aov12 <- aov(bio_12~code,data=rloc)
tuk <- HSD.test(aov12,"code")
order_12 <-tuk$group
order_12 <- as.data.table(cbind(order_12,rownames(order_12),c(1:length(order_12[,1]))))
colnames(order_12)[3:4] <-c('code','order')
order_12 <- order_12[order(order)]
write.csv(order_12,paste0(path,'species_group_rain.csv'))
setkey(rloc,code)
setkey(order_12,code)
plot_b12 <- rloc[order_12]
plot_b12[,i.bio_12:=NULL]
plot_b12 <- plot_b12[order(order)]
ggplot(data=plot_b12,aes(x=as.factor(reorder(code,order)),y=bio_12,fill=groups))+
geom_boxplot(outlier.colour=NA)+
theme_classic()+
labs(x='Species code',y='Annual precipitation (mm)',fill = "group")+
geom_hline(yintercept=c(250,500,1000,2000,4000), linetype="dashed", color = "gray51")
ggsave(paste0(path,"plot_result/bio_12.jpeg"),width = 13,height = 7,dpi=600)
library(rgbif)
library(data.table)
library(raster)
library(tictoc) # running time
library(parallel) #平行運算
name <- 'Heloniopsis koreana'
data <- as.data.table(occ_search(scientificName = name, hasGeospatialIssue=FALSE)$data)
View(data)
###### setup the function
gbif_and_clim <- function(name){
library(data.table)
library(rgbif)
library(raster)
library(tictoc)
result <- NULL
name <- 'Heloniopsis koreana'
data <- as.data.table(occ_search(scientificName = name, hasGeospatialIssue=FALSE)$data)
clim_d_n <- list.files('E:/Climdata/Chelsa_1979-2013_monthly')
for (i in 1:length(clim_d_n)){
rast <- raster(paste0('E:/Climdata/Chelsa_1979-2013_monthly/',clim_d_n[i]))
if (nrow(data)==0|!any(colnames(data)=='decimalLongitude')){name <- paste0('NULL_',name)
break
}else{
spot <- data[decimalLatitude!="NA",.(decimalLongitude,decimalLatitude,key,scientificName,year,month,day)]
dot <- spot[,.(decimalLongitude,decimalLatitude)]
x <- extract(rast,dot)
result <-cbind(result,x)
colnames(result)[i] <- paste0("mon_",i)
}
}
try(result <- cbind(spot,result))
write.csv(result,paste0("E:/忍者/R-work/Git/R-work/Chao/prim_result/",name,".csv"))
}
setwd("E:/忍者/R-work/Git/R-work/Chao")
svpath <- "E:/忍者/R-work/Git/R-work/Chao/prim_result"
nlist <-read.csv("name_list.txt")
cl <- makeCluster(8)
for (j in 1:length(nlist[,1])){
tic("total")
name <- as.character(nlist[j,1])
##### start extract the climate data
parLapply(cl,name,gbif_and_clim)
cat(j)
toc()
}
###### setup the function
gbif_and_clim <- function(name){
library(data.table)
library(rgbif)
library(raster)
library(tictoc)
result <- NULL
data <- as.data.table(occ_search(scientificName = name, hasGeospatialIssue=FALSE)$data)
clim_d_n <- list.files('E:/Climdata/Chelsa_1979-2013_monthly')
for (i in 1:length(clim_d_n)){
rast <- raster(paste0('E:/Climdata/Chelsa_1979-2013_monthly/',clim_d_n[i]))
if (nrow(data)==0|!any(colnames(data)=='decimalLongitude')){name <- paste0('NULL_',name)
break
}else{
spot <- data[decimalLatitude!="NA",.(decimalLongitude,decimalLatitude,key,scientificName,year,month,day)]
dot <- spot[,.(decimalLongitude,decimalLatitude)]
x <- extract(rast,dot)
result <-cbind(result,x)
colnames(result)[i] <- paste0("mon_",i)
}
}
try(result <- cbind(spot,result))
write.csv(result,paste0("E:/忍者/R-work/Git/R-work/Chao/prim_result/",name,".csv"))
}
setwd("E:/忍者/R-work/Git/R-work/Chao")
svpath <- "E:/忍者/R-work/Git/R-work/Chao/prim_result"
nlist <-read.csv("name_list.txt")
cl <- makeCluster(8)
for (j in 1:length(nlist[,1])){
tic("total")
name <- as.character(nlist[j,1])
##### start extract the climate data
parLapply(cl,name,gbif_and_clim)
cat(j)
toc()
}
result <- NULL
name <- 'Heloniopsis orientalis var. orientalis'
data <- as.data.table(occ_search(scientificName = name, hasGeospatialIssue=FALSE)$data)
View(data)
#name <- as.character(nlist[j,1])
##### start extract the climate data
name <- 'Heloniopsis breviscapa'
parLapply(cl,name,gbif_and_clim)
library(rgbif)
library(data.table)
library(raster)
library(tictoc) # running time
library(parallel) #平行運算
###########deal with data
setwd("E:/忍者/R-work/Git/R-work/Chao")
svpath <- "E:/忍者/R-work/Git/R-work/Chao/prim_result"
file_name <- list.files("prim_result/",pattern = '.csv')
base <- fread('phenology.csv')
setwd("E:/忍者/R-work/Git/R-work/Chao/prim_result/")
rdata <- lapply(file_name,fread)
View(data)
View(rdata)
rdata <- lapply(1:11,function(i){
rdata[[i]][,name:=sub('.csv','',file_name[i])]
})
View(rdata)
file_name <- list.files("prim_result/",pattern = '.csv')
base <- fread('phenology.csv')
###########deal with data
setwd("E:/忍者/R-work/Git/R-work/Chao")
svpath <- "E:/忍者/R-work/Git/R-work/Chao/prim_result"
file_name <- list.files("prim_result/",pattern = '.csv')
base <- fread('phenology.csv')
setwd("E:/忍者/R-work/Git/R-work/Chao/prim_result/")
rdata <- lapply(file_name,fread)
rdata <- lapply(1:10,function(i){
rdata[[i]][,name:=sub('.csv','',file_name[i])]
})
result_mon <- NULL
rdata <- lapply(file_name,fread)
setwd("E:/忍者/R-work/Git/R-work/Chao/prim_result/")
rdata <- lapply(file_name,fread)
file_name <- list.files("prim_result/",pattern = '.csv')
base <- fread('phenology.csv')
setwd("E:/忍者/R-work/Git/R-work/Chao/prim_result/")
rdata <- lapply(file_name,fread)
rdata <- lapply(1:length(file_name),function(i){
rdata[[i]][,name:=sub('.csv','',file_name[i])]
})
###########deal with data
setwd("E:/忍者/R-work/Git/R-work/Chao")
svpath <- "E:/忍者/R-work/Git/R-work/Chao/prim_result"
file_name <- list.files("prim_result/",pattern = '.csv')
base <- fread('phenology.csv')
setwd("E:/忍者/R-work/Git/R-work/Chao/prim_result/")
rdata <- lapply(file_name,fread)
rdata <- lapply(1:length(file_name),function(i){
rdata[[i]][,name:=sub('.csv','',file_name[i])]
})
result_mon <- NULL
for(i in 1:length(file_name)){
name <- rdata[[i]][1,name]
j <-which(base[,1]==name)[1]
st <- as.numeric(base[`j`,2])
ed <- as.numeric(base[`j`,3])
for (k in st:ed){
r <- rdata[[i]][,.(name,.SD),.SDcols=paste0('mon_',k)]
r[,mon:=k]
colnames(r)[2] <- 'Temp'
result_mon <- rbind(result_mon,r)
cat(paste("k=",k))
}
cat(i)
}
####################plot
result_mon[,temp:=as.numeric(Temp)]
write.csv(result_mon,"E:/忍者/R-work/Git/R-work/Chao/result_and_month.csv")
##############################deal with the specimen
rdata <- lapply(file_name,fread)
###########deal with data
path <- "E:/忍者/R-work/Git/R-work/Chao"
###########deal with data
path <- "E:/忍者/R-work/Git/R-work/Chao"
file_name <- list.files(paste0(path,"/prim_result/"),pattern = '.csv')
##############################deal with the specimen
setwd("E:/忍者/R-work/Git/R-work/Chao/prim_result/")
rdata <- lapply(file_name,fread)
rdata <- lapply(1:length(file_name),function(i){
rdata[[i]][,name:=sub('.csv','',file_name[i])]
})
result_mon_2 <- NULL
i=1
d <- rdata[[i]]
View(d)
d <- rdata[[i]][month!='NA']
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
# on data.tables
DT = data.table(year=2010:2014, v1=runif(5), v2=1:5, v3=letters[1:5])
# lag columns 'v1,v2,v3' DT by 1 and fill with 0
cols = c("v1","v2","v3")
anscols = paste("lead", cols, sep="_")
View(DT)
DT[, (anscols) := shift(.SD, 1, 0, "lead"), .SDcols=cols]
# on data.tables
library(data.table)
DT = data.table(year=2010:2014, v1=runif(5), v2=1:5, v3=letters[1:5])
# lag columns 'v1,v2,v3' DT by 1 and fill with 0
cols = c("v1","v2","v3")
anscols = paste("lead", cols, sep="_")
DT[, (anscols) := shift(.SD, 1, 0, "lead"), .SDcols=cols]
DT = data.table(year=2010:2014, v1=runif(5), v2=1:5, v3=letters[1:5])
# lag columns 'v1,v2,v3' DT by 1 and fill with 0
cols = c("v1","v2","v3")
anscols = paste("lead", cols, sep="_")I
anscols = paste("lead", cols, sep="_")
DT[, (anscols) := data.table::shift(.SD, 1, 0, "lead"), .SDcols=cols]
View(DT)
View(d)
r2 <- d[,temp:=.SD,.SDcols=past0('mon_',month)]
r2 <- d[,temp:=.SD,.SDcols=paste0('mon_',month)]
r2 <- d[,temp:=d[,paste0('mom_',month)]]
View(r2)
r2 <- d[,temp:=lappy(month,function(i){
i <- paste0('mom_',month)
return(i)
})]
r2 <- d[,temp:=lapply(month,function(i){
i <- paste0('mom_',month)
return(i)
})]
View(r2)
r2 <- d[,temp:=get(paste0('mom_',month))]
r2 <- d[,temp:=d[,get(paste0('mom_',month))]]
r2 <- d[,temp:=d[,eval(paste0('mom_',month))]]
View(r2)
r2 <- d[,temp:=eval(paste0('mom_',month))]
View(r2)
r2 <- d[,temp:=get(paste0('mon_',month))]
r2 <- d[,temp:=get(paste0('mon_',month))]
View(r2)
r2 <- d[,temp_mon:=paste0('mon_',month)]
View(r2)
r2 <- d[,temp:=get('mon_',month)]
r2 <- d[,temp:=get('mon_3')]
r2 <- d[,temp:=eval(paste0('mon_',month))]
View(r2)
mon <- d[`k`,month]
k=1
mon <- d[`k`,month]
temp <- NULL
for (k in length(d)){
mon <- d[`k`,month]
temp <- c(temp,mon)
}
cbind(d,temp)
temp <- d[`k`,which('mon_1',colnames(d))+`mon`]
which('mon_1',colnames(d))
colnames(d)
match('mon_1',colnames(d))
temp <- d[`k`,match('mon_1',colnames(d))+`mon`]
colnames(d))+`mon`
match('mon_1',colnames(d))+`mon`
d[`k`,match('mon_1',colnames(d))+`mon`]
d[1,15]
match('mon_1',colnames(d))+`mon`
d[`k`,month]
temp <- d[`k`,get(match('mon_1',colnames(d))+`mon`)]
temp <- d[`k`,eval(match('mon_1',colnames(d))+`mon`)]
temp
mon <- d[`k`,month]+match('mon_1',colnames(d))
temp <- d[`k`,`mon`]
temp <- d[`k`,get(`mon`)]
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))
temp <- d[`k`,`mon`]
temp <- d[`k`,mon,with=FALSE]
View(temp)
k=1
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))
temp <- d[`k`,mon,with=FALSE]
temp <- c(temp,mon)
View(temp)
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- NULL
k=1
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- d[`k`,mon,with=FALSE]
temp <- c(temp,mon)
View(temp)
temp <- NULL
k=1
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
result_mon_2 <- cbind(d[,1:8],temp)
View(result_mon_2)
result_mon_2 <- NULL
for(i in 1:length(file_name)){
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
temp <- NULL
for (k in length(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
temp <- c(temp,mon)
}
result_mon_2 <- cbind(d[,1:8],temp)
}
temp <- NULL
for (k in length(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
temp <- c(temp,mon)
}
temp
t_r <- NULL
for (k in length(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
t_r <- NULL
for (k in length(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- rbind(t_r,temp)
}
View(t_r)
length(d)
for (k in nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- rbind(t_r,temp)
}
View(t_r)
t_r <- NULL
for (k in nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
nrow(d)
t_r <- NULL
for (k in 1:nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
r2 <- cbind(d[,1:8],temp)
r_mon_spe <- NULL
for(i in 1:length(file_name)){
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
t_r <- NULL
for (k in 1:nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
r2 <- cbind(d[,1:8],temp)
r_mon_spe <- rbind(r_mon_spe,r2)
}
View(r_mon_spe)
r_mon_spe <- NULL
i=1
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
t_r <- NULL
for (k in 1:nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
r2 <- cbind(d[,1:8],temp)
View(r2)
r_2 <- NULL
for(i in 1:length(file_name)){
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
t_r <- NULL
for (k in 1:nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
r2 <- cbind(d[,1:8],t_r)
r_mon_spe <- rbind(r_mon_spe,r2)
}
View(r_mon_spe)
r_mon_spe <- NULL
r_2 <- NULL
for(i in 1:length(file_name)){
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
t_r <- NULL
for (k in 1:nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
r2 <- cbind(d[,c(1:8,name)],t_r)
r_mon_spe <- rbind(r_mon_spe,r2)
}
r_mon_spe <- NULL
r_2 <- NULL
for(i in 1:length(file_name)){
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
t_r <- NULL
for (k in 1:nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
r2 <- cbind(d[,.(1:8,name)],t_r)
r_mon_spe <- rbind(r_mon_spe,r2)
}
d[,.(1:8,name)]
i=1
r_mon_spe <- NULL
r_2 <- NULL
d <- rdata[[i]][month!='NA'][(month%in%3:5)]
t_r <- NULL
for (k in 1:nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
r2 <- cbind(d[,1:8],t_r,sub('.csv','',file_name[i]))
View(r2)
write.csv(r2,paste0(path,'result_',file_name[i]))
paste0(path,'result_',file_name[i])
write.csv(r2,paste0(path,'/result_',file_name[i]))
r_mon_spe <- NULL
r_2 <- NULL
for(i in 2:length(file_name)){
d <- rdata[[i]][month!='NA']
t_r <- NULL
for (k in 1:nrow(d)){
mon <- as.numeric(d[`k`,month]+match('mon_1',colnames(d)))-1
temp <- as.numeric(d[`k`,mon,with=FALSE])
t_r <- c(t_r,temp)
}
r2 <- cbind(d[,1:8],t_r,sub('.csv','',file_name[i]))
r_mon_spe <- rbind(r_mon_spe,r2)
}
write.csv(r_mon_spe,paste0(path,'/result_',file_name[i]))
